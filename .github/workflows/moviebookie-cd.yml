name: MovieBookie CD Pipeline

on:
  push:
    branches: [ "main" ]

jobs:
      # 컨테이너로 실행
      - name: Deploy to NCP Server
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.NCP_SERVER_HOST }}
          username: ${{ secrets.NCP_SERVER_USER }}
          password: ${{ secrets.NCP_SERVER_PASSWORD }}
          port: 22
          script: |
            sudo docker rm -f moviebookie || true
            sudo docker image rm ${{ secrets.DOCKERHUB_USERNAME }}/moviebookie:latest || true
            sudo docker pull ${{ secrets.DOCKERHUB_USERNAME }}/moviebookie
            sudo docker run -d -p 8080:8080 -e TZ=Asia/Seoul --name moviebookie -v ./logs:/var/log/spring ${{ secrets.DOCKERHUB_USERNAME }}/moviebookie
